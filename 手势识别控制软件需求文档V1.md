# 手势识别控制软件完整需求文档（补充开关版）

> 在“最终整理版”基础上补充两项：
>
> 1. **显示摄像开关**（仅控制预览显示，不等同于识别开关）
> 2. **启用鼠标移动开关**（全局允许/禁止手势驱动鼠标移动）

------

## 1. 项目目标

实现一套手势识别控制软件（参考 Gesture-Controlled-Virtual-Mouse）：

- 摄像头实时识别手势（静态/动态/复合/状态型）
- 将手势映射为 I/O 操作（鼠标、键盘、滚动、打开程序、shell 等）
- GUI 支持：模式切换、预览控制、OSD、手套校准、自定义手势录制、手势/动作/绑定全编辑
- 支持裸手与手套两种识别模式

------

## 2. 系统状态与开关（必须）

系统至少包含 **5 个**“用户可控开关/状态”，并要求在 UI 中可见、可操作，同时可在绑定系统里作为动作触发（如 toggle）。

### 2.1 识别开关 Recognition Enabled（必须）

- 含义：是否运行视觉推理与手势识别（识别链路开/关）
- 默认手势：`THUMBS_UP` → `toggle_recognition`
- 关闭时：不推理、不识别、不执行动作（可选仍采集画面用于预览）

### 2.2 执行开关 Execution Enabled（必须）

- 含义：识别仍继续，但是否执行动作（调试/演示）

- ```
  execution_enabled=false
  ```

  ：

  - 识别继续、OSD 继续
  - 所有动作不执行（包括鼠标移动/点击/滚动/键盘/启动程序/shell）
  - `toggle_execution` 必须仍可用

### 2.3 鼠标移动模式 Mouse Move Mode（必须）

- 含义：何时将手部点位映射为鼠标移动（例如在 `V_SIGN` 下启用）
- 该模式属于“交互模式”，用于避免抢占实体鼠标

### 2.4 显示摄像开关 Camera Preview Enabled（必须，新增确认）

- 含义：是否在 UI 中显示摄像画面预览（纯 UI 行为）
- 要求：
  - **关闭预览时仍可后台识别**（取决于识别开关）
  - 关闭预览不应影响识别/执行逻辑，只影响 UI 渲染与资源占用（降低 UI 负载）
  - 不允许出现 setText/setPixmap 交替导致闪烁（预览关闭时不要频繁切换 QLabel 内容）

### 2.5 启用鼠标移动开关 Mouse Move Output Enabled（必须，新增确认）

- 含义：全局允许/禁止“手势驱动鼠标移动输出”（moveTo 注入）

- 行为：

  - ```
    mouse_move_output_enabled=false
    ```

     

    时：

    - 即使识别到移动模式/手势，也 **不输出** 鼠标移动（worker invalidate）
    - 但仍允许执行非移动类动作（点击/滚动/快捷键等），除非 execution 开关关闭

- 用途：

  - 方便在某些场景临时禁用鼠标移动，避免干扰
  - 与“鼠标移动模式”区分：
    - **模式**决定“什么时候应该移动”；
    - **输出开关**决定“是否允许移动注入”。

------

## 3. 模式与视觉识别（必须）

- 裸手模式：MediaPipe Hands 关键点
- 手套模式：先实现方案 C（HSV + ROI + 可选轻量分割 + 几何特征），架构预留方案 B（贴标记点）

镜像：

- 摄像默认镜像显示
- 识别输入与预览一致
- 鼠标移动方向与画面手势一致

------

## 4. 手势体系（必须，完全可编辑）

### 4.1 手势字典可编辑（必须）

- 所有手势条目包含：
  - ID、名称、描述、默认用途、备注
  - 类型（static/dynamic/composite/state）
  - 适用模式（bare/glove/both）
  - 启用条件（例如仅在 mouse_move_mode=true 时）
  - 参数（阈值、稳定帧、冷却、比例系数等）

### 4.2 默认预置手势（可删改）

- `OPEN_PALM`：中立（Neutral，默认无动作）
- `THUMBS_UP`：toggle_recognition
- `V_SIGN`：鼠标移动模式启用（可配置）
- 鼠标移动模式内复合手势：
  - `PINCH_RIGHT_CLICK`（拇指+中指捏合）→ 右键
  - `INDEX_MIDDLE_DOUBLE_CLICK`（食指与中指并拢）→ 左键双击
  - `PINCH_SCROLL` → 比例滚动（纵向 dy，横向 dx 用 Shift+Wheel）
- 动态滑动手势：`SWIPE_*`（保留用于自定义绑定）
- 自定义手势：用户录制轨迹模板匹配（可增删改）

------

## 5. 动作/指令体系（必须，完全可编辑）

### 5.1 动作目录（Action Catalog）

必须至少支持：

- 系统/模式类：
  - `toggle_recognition`
  - `toggle_execution`
  - `toggle_camera_preview`（可选：也可只做 UI 开关不入绑定，但建议也可绑定）
  - `toggle_mouse_move_output`（新增）
  - `set_mouse_move_mode` / `toggle_mouse_move_mode`（可选）
- 鼠标类：
  - `click_left` / `double_click_left` / `click_right`
  - `mouse_down_left` / `mouse_up_left`
- 滚动类：
  - `scroll_v`
  - `scroll_h_shiftwheel`（横向滚动方案2）
  - `scroll_v_proportional`
  - `scroll_h_proportional_shiftwheel`
- 键盘/系统类：
  - `key` / `hotkey`
  - `open_program`
  - `shell`

> 明确不包含：窗口聚焦/切换。

### 5.2 绑定（Bindings）

- 全局绑定
- 按应用绑定（按前台进程名覆盖全局）
- UI 编辑器可增删改查、导入导出 preset

------

## 6. UI 要求（必须）

主界面必须提供至少以下开关/控件：

- 模式切换：裸手/手套
- **显示摄像开关**（新增）
- 镜像开关（默认开启）
- OSD 开关
- **识别开关状态**（可由手势/按钮切换）
- **执行开关**（可由手势/按钮切换）
- **启用鼠标移动开关**（新增，全局移动注入开/关）
- 鼠标移动参数：平滑/灵敏度/死区
- 配置保存/加载
- 子窗口：
  - 手势字典（展示与编辑：名称/描述/默认用途/备注/参数/条件）
  - 动作字典（动作类型与参数 schema）
  - 绑定编辑器（全局/按应用）
  - 手套 HSV 校准
  - 自定义手势录制与管理

------

## 7. 性能与稳定性（必须）

- 解决闪烁与高 CPU：
  - 推理与渲染解耦：最新帧缓存 + QTimer 渲染（20–30fps）
  - 推理降频（10–15fps）+ infer_scale + 降采集分辨率（默认 640×480）
  - Qt 缩放 FastTransformation
  - 鼠标 moveTo 后台线程限频，非移动/执行关闭/识别关闭时 invalidate
- 关闭摄像预览（Camera Preview Enabled=false）应显著降低 UI 渲染负载（但识别仍可继续）

------

## 8. 默认交互预置（可被用户修改）

- `THUMBS_UP` → toggle_recognition
- `OPEN_PALM` → 中立（默认不触发动作）
- `toggle_execution`：默认给一个手势或按钮（用户可改）
- `toggle_mouse_move_output`：默认给按钮（用户可改绑手势）
- `V_SIGN` → 鼠标移动模式启用
- 鼠标模式内：
  - 拇指+中指捏合 → 右键
  - 食指+中指并拢 → 双击
  - 捏合位移 → 比例滚动（横向用 Shift+Wheel）
- `SWIPE_*`：保留供用户自定义绑定